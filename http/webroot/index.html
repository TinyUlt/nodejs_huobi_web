<html>
<head>
    <script src="loader.js"></script>
    <script src="jquery.min.js"></script>
    <script type="text/javascript">

        let timeType = "halfMinute";
        let updateTime = {};
        updateTime["second"] = 10;
        updateTime["halfMinute"] = 30;
        updateTime["minute"] = 60;
        updateTime["fiveMinute"] = 60 * 5;
        updateTime["tenMinute"] = 60 * 10;
        updateTime["halfHour"] = 60 * 30;
        updateTime["hour"] = 60 * 60;
        function update(){
            $.get("/"+timeType,function(cd,status){

                let chartData =JSON.parse(cd) ;

                google.charts.load('current', {'packages':['line', 'corechart']});
                google.charts.setOnLoadCallback(drawChart);

                function drawChart() {

                    var chartDiv = document.getElementById('chart_div');

                    var data = new google.visualization.DataTable();
                    data.addColumn('datetime', 'Time');
                    data.addColumn('number', "BTC");
                    data.addColumn('number', "USD");
                    data.addColumn('number', "USDT");

                    var mydata=new Array()

                    let temptime = 0;
                    let tempbtc = 0;
                    let tempusd = 0;
                    let tempusdt = 0;


                    for(let i = 0; i < chartData.length; i++){

                        if(chartData[i].btc !=null){

                            tempbtc=chartData[i].btc;
                            break;
                        }
                    }
                    for(let i = 0; i < chartData.length; i++){

                        if(chartData[i].usd !=null){

                            tempusd=chartData[i].usd;
                            break;
                        }
                    }
                    for(let i = 0; i < chartData.length; i++){

                        if(chartData[i].usdt !=null){

                            tempusdt=chartData[i].usdt;
                            break;
                        }
                    }


                    for(let i = 0; i < chartData.length; i++){

                        mydata[i] = new Array();


//                        if(chartData[i]._id <= temptime){
//
//                            continue;
//
//                        }
//                        temptime = chartData[i]._id;
                        mydata[i][0]= new Date(chartData[i]._id);
                        if(chartData[i].btc !=null){

                            mydata[i][1]=chartData[i].btc;
                            tempbtc = mydata[i][1]
                        }else{
                            mydata[i][1]=tempbtc;

                        }

                        if(chartData[i].usd !=null){

                            mydata[i][2]=chartData[i].usd;
                            tempusd = mydata[i][2];
                        }else {
                            mydata[i][2] = tempusd;
                        }
                        if(chartData[i].usdt !=null){

                            mydata[i][3]=chartData[i].usdt;
                            tempusdt = mydata[i][3];
                        }else {
                            mydata[i][3] = tempusdt;
                        }
                    }

                    console.log(mydata);
                    data.addRows(mydata);


                    var materialOptions = {
                        chart: {
                            title: 'Average Temperatures and Daylight in Iceland Throughout the Year'
                        },
                        width: 900,
                        height: 500,
                        series: {
                            // Gives each series an axis name that matches the Y-axis below.
                            0: {axis: 'Temps'},
                            1: {axis: 'Daylight'}
                        },
                        axes: {
                            // Adds labels to each axis; they don't have to match the axis names.
                            y: {
                                Temps: {label: 'Temps (Celsius)'},
                                Daylight: {label: 'Daylight'}
                            }
                        }
                    };

                    var classicOptions = {
                        title: timeType + " Mul Coin Chart",
                        width: 1400,
                        height: 800,
                        // Gives each series an axis that matches the vAxes number below.
                        series: {
                            0: {targetAxisIndex: 0},
                            1: {targetAxisIndex: 1},
                            2: {targetAxisIndex: 1}
                        },
                        vAxes: {
                            // Adds titles to each axis.
                            0: {title: 'BTC'},
                            1: {title: 'USD'},
                            2: {title: 'USDT'}
                        },
//                        curveType: 'function',
//                        legend: { position: 'bottom' }
                    };

                    function drawMaterialChart() {
                        var materialChart = new google.charts.Line(chartDiv);
                        materialChart.draw(data, materialOptions);
//                        button.innerText = 'Change to Classic';
//                        button.onclick = drawClassicChart;
                    }

                    function drawClassicChart() {
                        var classicChart = new google.visualization.LineChart(chartDiv);
                        classicChart.draw(data, classicOptions);
//                        button.innerText = 'Change to Material';
//                        button.onclick = drawMaterialChart;
                    }

                    drawClassicChart();

                }
                setTimeout(update, 1000 * updateTime[timeType]);
            });
        }
        $(document).ready(function(){
            document.getElementById('second').onclick = function () {timeType = "second"; update();};
            document.getElementById('halfMinute').onclick = function () {timeType = "halfMinute"; update();};
            document.getElementById('minute').onclick = function () {timeType = "minute"; update();};
            document.getElementById('fiveMinute').onclick = function () {timeType = "fiveMinute"; update();};
            document.getElementById('tenMinute').onclick = function () {timeType = "tenMinute"; update();};
            document.getElementById('halfHour').onclick = function () {timeType = "halfHour"; update();};
            document.getElementById('hour').onclick = function () {timeType = "hour"; update();};
            update();
        });

    </script>
</head>
<body>
<button id="second">second</button>
<button id="halfMinute">halfMinute</button>
<button id="minute">minute</button>
<button id="fiveMinute">fiveMinute</button>
<button id="tenMinute">tenMinute</button>
<button id="halfHour">halfHour</button>
<button id="hour">hour</button>

<div id="chart_div" style="width: 900px; height: 500px"></div>
</body>
</html>